---
title: "STEPPs Control Document"
output: html_document
---

# Loading Libraries

```{r}

# I've tried as much as possible to call the packages explicitly from within the function calls.
# This may not be an exhaustive list of all the packages used.

require(neotoma)
require(maps)
require(fields)
require(raster)
require(rgdal)

```

# Configuration

```{r}
draws_version  <- 'v10'
pol_version    <- '7'

version        <- 7
my_date        <- "2017-01-07"

varves         <- read.csv('data/varves.csv', stringsAsFactors=FALSE)
vids           <- varves$id
states_vs      <- varves$state

```

# Bacon Runs

## Setting up the Output

This function creates all the required folders for Bacon runs within the `Cores` folder.  Currently this assumes you have a `Cores` folder already existing.

The function itself has no output, it just writes the files.  It might make more sense to have it pass things out and then write, but I dunno.

```{r setup_bacon, results='hide', message=FALSE, warning=FALSE}

source('R/setup_bacon.r')

# All output is going to a file in the `logs` directory.
sink(file("data/logs/setup_bacon.log", open = "wt"))

setup_bacon(my_date, version = version)

sink(file = NULL)

```

## Run Bacon

```{r}
source('R/run_bacon.r')

source('R/plot_bacon.r')

```

Then you need to manually choose the thicknesses.

Here you need to edit a CSV file by hand.

```{r}

# Add a check/assert here to review the age models before you do stuff.
#  Maybe we can make some simple rules here, but otherwise, I think the assert statement
#  looks for a version number file that is in line with the overall version number.

pollen_meta <- read.csv(paste0('../stepps-baconizing/data/pollen_meta_thick_v', pol_version, '.csv'), header=TRUE, stringsAsFactors=FALSE, sep=',')

```


# Pollen Data Stuff

```{r}
# Sourcing documents

source('R/build_pollen_ages.R')

```

